<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.75">
  <title>ุงุฏุจูุฏ ูุฑุญูู ุณุฑููฺฏ ูุญูุฏ ุตุฏุงูุช ฺฉุด</title>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
  <style>
    body {
      font-family: "Vazirmatn", sans-serif;
      background-color: #f3f2ef;
      margin: 0;
      padding: 0;
      text-align: center;
      direction: rtl;
    }
    header {
      background-color: #2f3640;
      color: white;
      padding: 20px;
      font-size: 22px;
    }

    /* gallery */
    .gallery {
      /* position: relative;
      max-width: 500px;
      margin: 16px auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);*/
      position: relative;
      width: 500px;
      height: 600px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 16px auto;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      border-radius: 10px;
    }
    .gallery img {
      /*width: 100%;
      height: 320px;
      object-fit: cover;
      display: none;*/
      width: 100%;
      height: 100%;
      object-fit: cover; /* Keeps aspect ratio, no cropping */
      display: none;
      object-position: top;
    }

    .gallery img.active {
      display: block;
    }
    .gallery .nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 20px;
    }
    .gallery .prev { right: 10px; }
    .gallery .next { left: 10px; }

    button {
      background-color: #353b48;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #718093;
    }
    .audio-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 500px;
      text-align: right;
    }
    .audio-section h3 {
      margin-top: 0;
      color: #2f3640;
    }
    audio {
      width: 100%;
      margin-top: 10px;
    }
    .counter {
      font-size: 14px;
      color: #555;
      margin-top: 8px;
    }
    .count-btn {
      margin-top: 10px;
      background-color: #27ae60;
    }
    .count-btn:hover {
      background-color: #2ecc71;
    }

    /* ุตููุงุช */
    .salavat-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }
    .salavat-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .salavat-buttons button {
      flex: 1;
      padding: 8px 0;
    }

    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 280px;
    }
    .popup-content h4 {
      margin-top: 0;
    }
    .popup-content input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      text-align: center;
    }
    .popup-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .popup-buttons button {
      width: 48%;
      padding: 8px 0;
    }
    .btn-green {
      background-color: #27ae60;
    }
    .btn-gray {
      background-color: #7f8c8d;
    }

    /* ุฒูุฏฺฏโูุงูู */
    .bio-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 600px;
      text-align: justify;
      line-height: 1.8;
      font-size: 15px;
    }
    .bio-section h2 {
      text-align: center;
      color: #2f3640;
    }

    footer {
      background: #2f3640;
      color: white;
      padding: 15px;
      font-size: 14px;
      margin-top: 40px;
    }

    /* ููุช ูพุงูพโุขูพ ุจุงุฒูุ ูพูุฑูุง ุตูุช ูุฎู ูโุดู ุชุง ุฑู ูพุงูพโุขูพ ูุงู */
    body.modal-open audio {
      visibility: hidden;
    }
    /* ูพุงูพโุขูพ ุจุงุฏ ุจุงูุงุชุฑ ุงุฒ ููู ูุงูโูุง ุจุงุดู */
    .popup {
      z-index: 9999;
    }
    
  </style>
</head>
<body>

<header>ุงุฏุจูุฏ ูุฑุญูู ุณุฑููฺฏ ูุญูุฏ ุตุฏุงูุช ฺฉุด</header>

<!-- background voice -->
<audio id="bgVoice" preload="auto" src="audio/marhoom.mp3"></audio>

<!-- replay button (hidden until the voice ends) -->
<div id="replayContainer" style="display:none; text-align:center; margin-top:20px;">
  <button id="replayBtn" 
          style="background:#27ae60; color:white; border:none; padding:10px 20px; border-radius:10px; font-size:16px; cursor:pointer;">
    ๐ ูพุฎุด ุฏูุจุงุฑู ุตุฏุง
  </button>
</div>

  
<!-- ฺฏุงูุฑ -->
<div class="gallery">
  <img src="images/photo1.jpg" class="active" alt="ุนฺฉุณ ฑ">
  <img src="images/photo2.jpg" alt="ุนฺฉุณ ฒ">
  <img src="images/photo3.jpg" alt="ุนฺฉุณ ณ">
  <img src="images/photo4.jpg" alt="ุนฺฉุณ ด">

  <button class="nav prev" onclick="prevImage()">โน</button>
  <button class="nav next" onclick="nextImage()">โบ</button>
</div>

<!-- ุฒูุฏฺฏโูุงูู -->
<div class="bio-section">
  <h2>ุฒูุฏฺฏโูุงูู ูุฑุญูู ุณุฑููฺฏ ูุญูุฏ ุตุฏุงูุช ฺฉุด</h2>
  <p>
    ุงุดุงู ุชุงุฑุฎ ฑถ ุงุณููุฏ ุฏููโ ุจุณุชุ ุฏุฑ ุฎุงููุงุฏูโ ูุฐูุจ ฺุดู ุจู ุฌูุงู ฺฏุดูุฏูุฏ. ุจุฑุง ุชุญุตู ุฏุฑ ุฑุดุชูโ ุฑุงุถุ ุฏุฑ ุฏุจุฑุณุชุงู ูุฑุงุชุ ุจู ุงุตููุงู ุขูุฏูุฏ ู ูุดุบูู ุจู ุชุญุตู ุดุฏูุฏ ู ุจุนุฏ ุงุฒ ุฏูพูู ูุงุฑุฏ ุงุฑุชุด ุดุฏูุฏ.<br>
    ุงุดุงู ุฏุฑ ุฏูุฑุงู ุงูููุงุจ ูู ุฏุฑ ุงุฑุชุด ุจุงู ูุงูุฏู ู ุฏุฑ ธ ุณุงู ุฏูุงุน ููุฏุณุ ุฏุฑ ุฌุจููโูุง ุญู ุนูู ุจุงุทู ุญุถูุฑ ูุนุงู ุฏุงุดุชูุฏ.<br>
    ุณุฑููฺฏ ุฏุฑ ุชุงุฑุฎ ฑท ุฏ ทท ููุณุฑ ู ูุฑุฒูุฏ ุจุฑูููุฏุดุงู ุฑุง ุท ฺฉ ุชุตุงุฏู ุงุฒ ุฏุณุช ุฏุงุฏูุฏุ ุจุง ุงู ฺฉู ุบู ุจุฒุฑฺฏ ุฏุฑ ุณูู ุฏุงุดุชูุฏ ุงูุง ููุดู ูุจุฎูุฏ ุจุฑ ูุจ ุฏุงุดุชูุฏ ู ุจู ุฏฺฏุฑุงู ุฑูุญู ูโุฏุงุฏูุฏ.<br>
    ุงุดุงู ุฎุงุฏู ุงูู ุจุช ุจูุฏูุฏ ู ูฺููุช ุงุฒ ฺฉูฺฉ ุจู ูุงุฒููุฏุงู ุฏุฑุบ ููโฺฉุฑุฏูุฏ.<br>
    ูพุงูโูุง ุฏููุดู ุงุดุงู ุจุฑุง ุฏูุณุชุงู ู ุขุดูุงุงูุ ูุฑุฑูุฒ ุตุจุญ ุงุฑุณุงู ูโุดุฏ ุชุง ุจู ููู ุฑูุญู ุจุฏููุฏ ู ุงูฺฏููู ูุฑฺฉุณ ุจุชูุงูุฏ ุจุง ุงูุฑฺ ูุถุงุนู ุฑูุฒุด ุฑุง ุขุบุงุฒ ฺฉูุฏ.<br>
    ุฑูุญุด ุดุงุฏ ู ุงุฏุด ฺฏุฑุงู ุจุงุฏ ๐น
  </p>
</div>

<!-- ุณูุฑูโูุง ุฒุฑ ูู -->

  
<!-- ุตููุงุช -->
<div class="salavat-section">
  <h3>ุตููุงุช</h3>
  <div class="salavat-buttons">
    <!-- <button class="count-btn" onclick="increaseCount('salavat')">ุซุจุช ุตููุงุช ุชฺฉ</button> -->
    <button class="count-btn" onclick="setCounter('salavat')">ุซุจุช ุตููุงุช ุชฺฉ</button>
    <button class="count-btn" onclick="openPopup()">ุซุจุช ุตููุงุช ุชุนุฏุงุฏ</button>
  </div>
  <div class="counter" id="salavat">ุชุนุฏุงุฏ ุตููุงุช: ฐ</div>
</div>

<!-- ูพุงูพโุขูพ -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h4>ุชุนุฏุงุฏ ุตููุงุช</h4>
    <p>ุชุนุฏุงุฏ ุตููุงุช ุฑุง ูุงุฑุฏ ฺฉูุฏ:</p>
    <input type="number" id="salavatCountInput" placeholder="ูุซูุงู 100">
    <div class="popup-buttons">
      <!-- <button class="btn-green" onclick="submitSalavatCount()">ุซุจุช ุตููุงุช</button> -->
      <button class="btn-green" onclick="setCounter('salavat', document.getElementById('salavatCountInput').value);closePopup();">ุซุจุช ุตููุงุช</button>
      <button class="btn-gray" onclick="closePopup()">ุจุณุชู ููู</button>
    </div>
  </div>
</div>
  
  <div class="audio-section">
  <h3>ูุงุชุญู</h3>
  <audio controls onplay="handlePlay('fatehe', this)">
    <source src="audio/fatehe.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('fatehe')">ุซุจุช ูุงุชุญู</button> -->
  <button class="count-btn" onclick="setCounter('fatehe')">ุซุจุช ูุงุชุญู</button>
  <div class="counter" id="fatehe">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุขุช ุงูฺฉุฑุณ</h3>
  <audio controls onplay="handlePlay('ayat', this)">
    <source src="audio/ayat.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('ayat')">ุซุจุช ุขุช ุงูฺฉุฑุณ</button> -->
  <button class="count-btn" onclick="setCounter('ayat')">ุซุจุช ุขุช ุงูฺฉุฑุณ</button>
  <div class="counter" id="ayat">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุณูุฑู ุณ</h3>
  <audio controls onplay="handlePlay('yasin', this)">
    <source src="audio/yasin.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('yasin')">ุซุจุช ุณูุฑู ุณ</button> -->
  <button class="count-btn" onclick="setCounter('yasin')">ุซุจุช ุณูุฑู ุณ</button>
  <div class="counter" id="yasin">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุณูุฑู ูุงูุนู</h3>
  <audio controls onplay="handlePlay('vaqea', this)">
    <source src="audio/vaqea.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('vaqea')">ุซุจุช ุณูุฑู ูุงูุนู</button> -->
  <button class="count-btn" onclick="setCounter('vaqea')">ุซุจุช ุณูุฑู ูุงูุนู</button>
  <div class="counter" id="vaqea">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุณูุฑู ุงูุฑุญูู</h3>
  <audio controls onplay="handlePlay('rahman', this)">
    <source src="audio/rahman.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('rahman')">ุซุจุช ุณูุฑู ุงูุฑุญูู</button> -->
  <button class="count-btn" onclick="setCounter('rahman')">ุซุจุช ุณูุฑู ุงูุฑุญูู</button>
  <div class="counter" id="rahman">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุณูุฑู ููฺฉ</h3>
  <audio controls onplay="handlePlay('molk', this)">
    <source src="audio/molk.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('molk')">ุซุจุช ุณูุฑู ููฺฉ</button> -->
  <button class="count-btn" onclick="setCounter('molk')">ุซุจุช ุณูุฑู ููฺฉ</button>
  <div class="counter" id="molk">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุณูุฑู ูุฏุฑ</h3>
  <audio controls onplay="handlePlay('qadr', this)">
    <source src="audio/qadr.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('qadr')">ุซุจุช ุณูุฑู ูุฏุฑ</button> -->
  <button class="count-btn" onclick="setCounter('qadr')">ุซุจุช ุณูุฑู ูุฏุฑ</button>
  <div class="counter" id="qadr">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>

<div class="audio-section">
  <h3>ุฒุงุฑุช ุนุงุดูุฑุง</h3>
  <audio controls onplay="handlePlay('ashura', this)">
    <source src="audio/ashura.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('ashura')">ุซุจุช ุฒุงุฑุช ุนุงุดูุฑุง</button> -->
  <button class="count-btn" onclick="setCounter('ashura')">ุซุจุช ุฒุงุฑุช ุนุงุดูุฑุง</button>
  <div class="counter" id="ashura">ุชุนุฏุงุฏ ูุฑุงุฆุช: ฐ</div>
</div>


<footer>
  ุฑูุญุด ุดุงุฏ ู ุงุฏุด ฺฏุฑุงู ๐น
  <p>ุทุฑุงุญ: ุนููุญูุฏ ุตุฏุงูุช ฺฉุด <br>
  ุงูู: alimohamad.sedaghatkish@gmail.com</p>
</footer>

<script>
  // ฺฏุงูุฑ
  let index = 0;
  const images = document.querySelectorAll(".gallery img");
  function showImage(i) {
    images.forEach(img => img.classList.remove("active"));
    images[i].classList.add("active");
  }
  function nextImage() {
    index = (index + 1) % images.length;
    showImage(index);
  }
  function prevImage() {
    index = (index - 1 + images.length) % images.length;
    showImage(index);
  }

  // ุดูุงุฑูุฏู
  // Counter API (Cloudflare Workers)
  const API_URL = "https://cool-snowflake-d2fe.alimohamad-sedaghatkish.workers.dev/";
  // Get counter value by key
  async function getCounter(key) {
    try {
      const response = await fetch(API_URL + "?key=" + key, { method: "GET" });
      const data = await response.json();
      return data;
    } catch (err) {
      console.error("Error fetching counter:", err);
      return null;
    }
  }
  // Set counter value by key
  async function setCounter(key, val=1) {
    try {
      const response = await fetch(API_URL + "?key=" + key + "&val=" + val, { 
        method: "POST",
        headers: { "Content-Type": "application/json" }
      });
      const data = await response.json();
      const el = document.getElementById(key);
      if (el) el.innerText = key === 'salavat' ? `ุชุนุฏุงุฏ ุตููุงุช: ${data.count}` : `ุชุนุฏุงุฏ ูุฑุงุฆุช: ${data.count}`;
    } catch (err) {
      console.error("Error setting counter:", err);
      return null;
    }
  }

  //const counts = JSON.parse(localStorage.getItem("counts")) || {
  //  fatehe: 0, ayat: 0, yasin: 0, vaqea: 0, rahman: 0, molk: 0, qadr: 0, ashura: 0, salavat: 0
  //};
  async function updateDisplay() {
    for (const key of ['salavat', 'fatehe', 'ayat', 'yasin', 'vaqea', 'rahman', 'molk', 'qadr', 'ashura']) {
      const data = await getCounter(key);
      let count = data.count;
      const el = document.getElementById(key);
      if (el) el.innerText = key === 'salavat' ? `ุชุนุฏุงุฏ ุตููุงุช: ${count}` : `ุชุนุฏุงุฏ ูุฑุงุฆุช: ${count}`;
    }
  }
  //function increaseCount(key) {
  //  counts[key]++;
  //  localStorage.setItem("counts", JSON.stringify(counts));
  //  updateDisplay();
  //}
  function handlePlay(key, audioElement) {
    audioElement.onended = () => {
      //increaseCount(key);
      setCounter(key);
    };
  }

  // ุตููุงุช ูพุงูพโุขูพ
  const popup = document.getElementById("popup");
  function openPopup() { popup.style.display = "flex";
                       document.body.classList.add("modal-open"); // ูุฎู ฺฉุฑุฏู ูพูุฑูุง
                       }
  function closePopup() { popup.style.display = "none";
                        document.body.classList.remove("modal-open"); // ุจุฑฺฏุฑุฏููุฏู ูพูุฑูุง
                        }
  //function submitSalavatCount() {
  //  const val = parseInt(document.getElementById("salavatCountInput").value);
  //  if (!isNaN(val) && val > 0) {
  //    counts.salavat += val;
  //    localStorage.setItem("counts", JSON.stringify(counts));
  //  }
  //  closePopup();
  //}

  updateDisplay();

  /* ========== Background voice autoplay + replay button (instant replay fix) ========== */
const bgVoice = document.getElementById('bgVoice');
const replayContainer = document.getElementById('replayContainer');
const replayBtn = document.getElementById('replayBtn');
const allAudios = document.querySelectorAll('.audio-section audio'); // ุชูุงู ููุณโูุง ุณูุฑูโูุง

// ุงุณุชุงู ูุฎู ฺฉุฑุฏู ุฏฺฉูู ุจู ุฌุง display:none
replayContainer.style.opacity = '0';
replayContainer.style.pointerEvents = 'none';
replayContainer.style.transition = 'opacity 0.3s ease';

// ุชุงุจุน ููุงุด ุฏฺฉูู
function showReplayButton() {
  replayContainer.style.opacity = '1';
  replayContainer.style.pointerEvents = 'auto';
}

// ุชุงุจุน ูพููุงู ฺฉุฑุฏู ุฏฺฉูู
function hideReplayButton() {
  replayContainer.style.opacity = '0';
  replayContainer.style.pointerEvents = 'none';
}

// ุชูุงุด ุจุฑุง ูพุฎุด ุฎูุฏฺฉุงุฑ ุตุฏุง ูุฑุญูู
async function tryAutoplayBgVoice() {
  try {
    await bgVoice.play();
    console.log('Background voice started playing.');
  } catch (err) {
    console.log('Autoplay blocked by browser. Waiting for user interaction...');
    document.body.addEventListener('click', handleFirstInteraction, { once: true });
  }
}

// ููุช ุตุฏุง ูุฑุญูู ุชููู ุจุดู ุง ูุทุน ุจุดู โ ุฏฺฉูู ูพุฎุด ุฏูุจุงุฑู ุธุงูุฑ ุจุดู
bgVoice.addEventListener('ended', showReplayButton);
bgVoice.addEventListener('pause', showReplayButton);

// ููุช ุฏฺฉูู ูพุฎุด ุฏูุจุงุฑู ฺฉูฺฉ ุจุดู โ ุตุฏุง ูุฑุญูู ุงุฒ ุงูู ูพุฎุด ุจุดู ู ุฏฺฉูู ูพููุงู ุดู
replayBtn.addEventListener('click', async () => {
  stopAllSurahVoices(); // ููู ููุณโูุง ูุทุน ุจุดู
  try {
    bgVoice.currentTime = 0;
    await bgVoice.play(); // ูพุฎุด ููุฑ
    hideReplayButton();
    console.log('Background voice replayed.');
  } catch (err) {
    console.log('Play failed:', err);
  }
});

// ุงููู ุชุนุงูู ฺฉุงุฑุจุฑ (ุฏุฑ ุตูุฑุช ุจูุงฺฉ autoplay)
function handleFirstInteraction() {
  bgVoice.play();
}

// ุชุงุจุน ูุทุน ููู ููุณโูุง ุณูุฑูโูุง
function stopAllSurahVoices() {
  allAudios.forEach(a => {
    a.pause();
    a.currentTime = 0;
  });
}

// ููุช ฺฉ ุงุฒ ููุณโูุง ุณูุฑู ูพู ุจุดู โ ุตุฏุง ูุฑุญูู ูุทุน ุจุดู
allAudios.forEach(audio => {
  audio.addEventListener('play', () => {
    bgVoice.pause();
    bgVoice.currentTime = 0;
    showReplayButton();
    allAudios.forEach(a => {
      if (a !== audio) {
        a.pause();
        a.currentTime = 0;
      }
    });
  });
});

// ุดุฑูุน ุฎูุฏฺฉุงุฑ ูพุฎุด (ุฏุฑ ุญุฏ ูุฌุงุฒ ูุฑูุฑฺฏุฑ)
tryAutoplayBgVoice();

</script>  
</body>
</html>


