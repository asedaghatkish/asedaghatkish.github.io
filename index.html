<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.75">
  <title>یادبود مرحوم سرهنگ محمد صداقت کیش</title>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
  <style>
    body {
      font-family: "Vazirmatn", sans-serif;
      background-color: #f3f2ef;
      margin: 0;
      padding: 0;
      text-align: center;
      direction: rtl;
    }
    header {
      background-color: #2f3640;
      color: white;
      padding: 20px;
      font-size: 22px;
    }

    /* gallery */
    .gallery {
      /* position: relative;
      max-width: 500px;
      margin: 16px auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);*/
      position: relative;
      width: 500px;
      height: 600px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 16px auto;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      border-radius: 10px;
    }
    .gallery img {
      /*width: 100%;
      height: 320px;
      object-fit: cover;
      display: none;*/
      width: 100%;
      height: 100%;
      object-fit: cover; /* Keeps aspect ratio, no cropping */
      display: none;
      object-position: top;
    }

    .gallery img.active {
      display: block;
    }
    .gallery .nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 20px;
    }
    .gallery .prev { right: 10px; }
    .gallery .next { left: 10px; }

    button {
      background-color: #353b48;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #718093;
    }
    .audio-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 500px;
      text-align: right;
    }
    .audio-section h3 {
      margin-top: 0;
      color: #2f3640;
    }
    audio {
      width: 100%;
      margin-top: 10px;
    }
    .counter {
      font-size: 14px;
      color: #555;
      margin-top: 8px;
    }
    .count-btn {
      margin-top: 10px;
      background-color: #27ae60;
    }
    .count-btn:hover {
      background-color: #2ecc71;
    }

    /* صلوات */
    .salavat-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }
    .salavat-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .salavat-buttons button {
      flex: 1;
      padding: 8px 0;
    }

    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 280px;
    }
    .popup-content h4 {
      margin-top: 0;
    }
    .popup-content input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      text-align: center;
    }
    .popup-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .popup-buttons button {
      width: 48%;
      padding: 8px 0;
    }
    .btn-green {
      background-color: #27ae60;
    }
    .btn-gray {
      background-color: #7f8c8d;
    }

    /* زندگی‌نامه */
    .bio-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 600px;
      text-align: justify;
      line-height: 1.8;
      font-size: 15px;
    }
    .bio-section h2 {
      text-align: center;
      color: #2f3640;
    }

    footer {
      background: #2f3640;
      color: white;
      padding: 15px;
      font-size: 14px;
      margin-top: 40px;
    }

    /* وقتی پاپ‌آپ بازه، پلیرهای صوتی مخفی می‌شن تا روی پاپ‌آپ نیان */
    body.modal-open audio {
      visibility: hidden;
    }
    /* پاپ‌آپ باید بالاتر از همه لایه‌ها باشه */
    .popup {
      z-index: 9999;
    }
    
  </style>
</head>
<body>

<header>یادبود مرحوم سرهنگ محمد صداقت کیش</header>

<!-- background voice -->
<audio id="bgVoice" preload="auto" src="audio/marhoom.mp3"></audio>

<!-- replay button (hidden until the voice ends) -->
<div id="replayContainer" style="display:none; text-align:center; margin-top:20px;">
  <button id="replayBtn" 
          style="background:#27ae60; color:white; border:none; padding:10px 20px; border-radius:10px; font-size:16px; cursor:pointer;">
    🔁 پخش دوباره صدا
  </button>
</div>

  
<!-- گالری -->
<div class="gallery">
  <img src="images/photo1.jpg" class="active" alt="عکس ۱">
  <img src="images/photo2.jpg" alt="عکس ۲">
  <img src="images/photo3.jpg" alt="عکس ۳">
  <img src="images/photo4.jpg" alt="عکس ۴">

  <button class="nav prev" onclick="prevImage()">‹</button>
  <button class="nav next" onclick="nextImage()">›</button>
</div>

<!-- زندگی‌نامه -->
<div class="bio-section">
  <h2>زندگی‌نامه مرحوم سرهنگ محمد صداقت کیش</h2>
  <p>
    ایشان تاریخ ۱۶ اسفند دهه‌ی بیست، در خانواده‌ی مذهبی چشم به جهان گشودند. برای تحصیل در رشته‌ی ریاضی، در دبیرستان هراتی، به اصفهان آمدند و مشغول به تحصیل شدند و بعد از دیپلم وارد ارتش شدند.<br>
    ایشان در دوران انقلاب هم در ارتش باقی مانده و در ۸ سال دفاع مقدس، در جبهه‌های حق علیه باطل حضور فعال داشتند.<br>
    سرهنگ در تاریخ ۱۷ دی ۷۷ همسر و فرزند برومندشان را طی یک تصادف از دست دادند، با این که غم بزرگی در سینه داشتند اما همیشه لبخند بر لب داشتند و به دیگران روحیه می‌دادند.<br>
    ایشان خادم اهل بیت بودند و هیچوقت از کمک به نیازمندان دریغ نمی‌کردند.<br>
    پیام‌های دلنشین ایشان برای دوستان و آشنایان، هرروز صبح ارسال می‌شد تا به همه روحیه بدهند و اینگونه هرکس بتواند با انرژی مضاعف روزش را آغاز کند.<br>
    روحش شاد و یادش گرامی باد 🌹
  </p>
</div>

<!-- سوره‌ها زیر هم -->

  
<!-- صلوات -->
<div class="salavat-section">
  <h3>صلوات</h3>
  <div class="salavat-buttons">
    <!-- <button class="count-btn" onclick="increaseCount('salavat')">ثبت صلوات تکی</button> -->
    <button class="count-btn" onclick="setCounter('salavat')">ثبت صلوات تکی</button>
    <button class="count-btn" onclick="openPopup()">ثبت صلوات تعداد</button>
  </div>
  <div class="counter" id="salavat">تعداد صلوات: ۰</div>
</div>

<!-- پاپ‌آپ -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h4>تعداد صلوات</h4>
    <p>تعداد صلوات را وارد کنید:</p>
    <input type="number" id="salavatCountInput" placeholder="مثلاً 100">
    <div class="popup-buttons">
      <!-- <button class="btn-green" onclick="submitSalavatCount()">ثبت صلوات</button> -->
      <button class="btn-green" onclick="setCounter('salavat', document.getElementById('salavatCountInput').value);closePopup();">ثبت صلوات</button>
      <button class="btn-gray" onclick="closePopup()">بستن منو</button>
    </div>
  </div>
</div>
  
  <div class="audio-section">
  <h3>فاتحه</h3>
  <audio controls onplay="handlePlay('fatehe', this)">
    <source src="audio/fatehe.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('fatehe')">ثبت فاتحه</button> -->
  <button class="count-btn" onclick="setCounter('fatehe')">ثبت فاتحه</button>
  <div class="counter" id="fatehe">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>آیت الکرسی</h3>
  <audio controls onplay="handlePlay('ayat', this)">
    <source src="audio/ayat.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('ayat')">ثبت آیت الکرسی</button> -->
  <button class="count-btn" onclick="setCounter('ayat')">ثبت آیت الکرسی</button>
  <div class="counter" id="ayat">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>سوره یس</h3>
  <audio controls onplay="handlePlay('yasin', this)">
    <source src="audio/yasin.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('yasin')">ثبت سوره یس</button> -->
  <button class="count-btn" onclick="setCounter('yasin')">ثبت سوره یس</button>
  <div class="counter" id="yasin">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>سوره واقعه</h3>
  <audio controls onplay="handlePlay('vaqea', this)">
    <source src="audio/vaqea.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('vaqea')">ثبت سوره واقعه</button> -->
  <button class="count-btn" onclick="setCounter('vaqea')">ثبت سوره واقعه</button>
  <div class="counter" id="vaqea">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>سوره الرحمن</h3>
  <audio controls onplay="handlePlay('rahman', this)">
    <source src="audio/rahman.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('rahman')">ثبت سوره الرحمن</button> -->
  <button class="count-btn" onclick="setCounter('rahman')">ثبت سوره الرحمن</button>
  <div class="counter" id="rahman">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>سوره ملک</h3>
  <audio controls onplay="handlePlay('molk', this)">
    <source src="audio/molk.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('molk')">ثبت سوره ملک</button> -->
  <button class="count-btn" onclick="setCounter('molk')">ثبت سوره ملک</button>
  <div class="counter" id="molk">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>سوره قدر</h3>
  <audio controls onplay="handlePlay('qadr', this)">
    <source src="audio/qadr.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('qadr')">ثبت سوره قدر</button> -->
  <button class="count-btn" onclick="setCounter('qadr')">ثبت سوره قدر</button>
  <div class="counter" id="qadr">تعداد قرائت: ۰</div>
</div>

<div class="audio-section">
  <h3>زیارت عاشورا</h3>
  <audio controls onplay="handlePlay('ashura', this)">
    <source src="audio/ashura.mp3" type="audio/mpeg">
  </audio>
  <!-- <button class="count-btn" onclick="increaseCount('ashura')">ثبت زیارت عاشورا</button> -->
  <button class="count-btn" onclick="setCounter('ashura')">ثبت زیارت عاشورا</button>
  <div class="counter" id="ashura">تعداد قرائت: ۰</div>
</div>


<footer>
  روحش شاد و یادش گرامی 🌹
  <p>طراح: علیمحمد صداقت کیش <br>
  ایمیل: alimohamad.sedaghatkish@gmail.com</p>
</footer>

<script>
  // گالری
  let index = 0;
  const images = document.querySelectorAll(".gallery img");
  function showImage(i) {
    images.forEach(img => img.classList.remove("active"));
    images[i].classList.add("active");
  }
  function nextImage() {
    index = (index + 1) % images.length;
    showImage(index);
  }
  function prevImage() {
    index = (index - 1 + images.length) % images.length;
    showImage(index);
  }

  // شمارنده
  // Counter API (Cloudflare Workers)
  const API_URL = "https://cool-snowflake-d2fe.alimohamad-sedaghatkish.workers.dev/";
  // Get counter value by key
  async function getCounter(key) {
    try {
      const response = await fetch(API_URL + "?key=" + key, { method: "GET" });
      const data = await response.json();
      return data;
    } catch (err) {
      console.error("Error fetching counter:", err);
      return null;
    }
  }
  // Set counter value by key
  async function setCounter(key, val=1) {
    try {
      const response = await fetch(API_URL + "?key=" + key + "&val=" + val, { 
        method: "POST",
        headers: { "Content-Type": "application/json" }
      });
      const data = await response.json();
      const el = document.getElementById(key);
      if (el) el.innerText = key === 'salavat' ? `تعداد صلوات: ${data.count}` : `تعداد قرائت: ${data.count}`;
    } catch (err) {
      console.error("Error setting counter:", err);
      return null;
    }
  }

  //const counts = JSON.parse(localStorage.getItem("counts")) || {
  //  fatehe: 0, ayat: 0, yasin: 0, vaqea: 0, rahman: 0, molk: 0, qadr: 0, ashura: 0, salavat: 0
  //};
  async function updateDisplay() {
    for (const key of ['salavat', 'fatehe', 'ayat', 'yasin', 'vaqea', 'rahman', 'molk', 'qadr', 'ashura']) {
      const data = await getCounter(key);
      let count = data.count;
      const el = document.getElementById(key);
      if (el) el.innerText = key === 'salavat' ? `تعداد صلوات: ${count}` : `تعداد قرائت: ${count}`;
    }
  }
  //function increaseCount(key) {
  //  counts[key]++;
  //  localStorage.setItem("counts", JSON.stringify(counts));
  //  updateDisplay();
  //}
  function handlePlay(key, audioElement) {
    audioElement.onended = () => {
      //increaseCount(key);
      setCounter(key);
    };
  }

  // صلوات پاپ‌آپ
  const popup = document.getElementById("popup");
  function openPopup() { popup.style.display = "flex";
                       document.body.classList.add("modal-open"); // مخفی کردن پلیرها
                       }
  function closePopup() { popup.style.display = "none";
                        document.body.classList.remove("modal-open"); // برگردوندن پلیرها
                        }
  //function submitSalavatCount() {
  //  const val = parseInt(document.getElementById("salavatCountInput").value);
  //  if (!isNaN(val) && val > 0) {
  //    counts.salavat += val;
  //    localStorage.setItem("counts", JSON.stringify(counts));
  //  }
  //  closePopup();
  //}

  updateDisplay();

  /* ========== Background voice autoplay + replay button (always visible after stop) ========== */
const bgVoice = document.getElementById('bgVoice');
const replayContainer = document.getElementById('replayContainer');
const replayBtn = document.getElementById('replayBtn');
const allAudios = document.querySelectorAll('.audio-section audio'); // تمام وویس‌های سوره‌ها

// تلاش برای پخش خودکار صدای مرحوم
async function tryAutoplayBgVoice() {
  try {
    await bgVoice.play();
    console.log('Background voice started playing.');
  } catch (err) {
    console.log('Autoplay blocked by browser. Waiting for user interaction...');
    document.body.addEventListener('click', handleFirstInteraction, { once: true });
  }
}

// وقتی صدای مرحوم تموم بشه → دکمه پخش دوباره ظاهر بشه
bgVoice.addEventListener('ended', () => {
  replayContainer.style.display = 'block';
});

// وقتی دکمه‌ی پخش دوباره کلیک بشه → صدای مرحوم از اول پخش بشه و دکمه پنهان شه
replayBtn.addEventListener('click', () => {
  stopAllSurahVoices(); // همه وویس‌ها قطع بشن
  bgVoice.currentTime = 0;
  bgVoice.play();
  replayContainer.style.display = 'none';
});

// وقتی کاربر برای اولین بار کلیک کرد → صدای مرحوم شروع بشه
function handleFirstInteraction() {
  bgVoice.play();
}

// تابع قطع همه وویس‌های سوره‌ها
function stopAllSurahVoices() {
  allAudios.forEach(a => {
    a.pause();
    a.currentTime = 0;
  });
}

// وقتی هر وویسی از سوره‌ها پلی بشه → صدای مرحوم قطع و دکمه پخش دوباره ظاهر شه
allAudios.forEach(audio => {
  audio.addEventListener('play', () => {
    bgVoice.pause();
    bgVoice.currentTime = 0;
    replayContainer.style.display = 'block'; // دکمه همیشه ظاهر شه بعد از قطع
    allAudios.forEach(a => {
      if (a !== audio) {
        a.pause();
        a.currentTime = 0;
      }
    });
  });
});

// اگر صدای مرحوم به هر دلیلی قطع شد → دکمه پخش دوباره ظاهر بشه
bgVoice.addEventListener('pause', () => {
  replayContainer.style.display = 'block';
});

// شروع خودکار پخش (در حد مجاز مرورگر)
tryAutoplayBgVoice();

</script>  
</body>
</html>

